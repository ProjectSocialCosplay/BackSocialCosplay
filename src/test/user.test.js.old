const {server} = require('../index')
const {gql} = require('apollo-server-express');
const{connectToDb, dropTestDb, closeDbConnection} = require('./test-setup');
const { createTestClient } = require('apollo-server-testing');

const {query, mutate} = createTestClient(server)

beforeAll(async () => {
    console.log("BEFOR ALL")
    await connectToDb().then(()=>{
        dropTestDb()
    })
});

afterAll(async () => {
    console.log("AFTER ALL")
    await dropTestDb(()=>{
        closeDbConnection()
    })
});

describe('User register',  () => {

    it("insert User", async () => {

        const query = gql`mutation {
                 createUser( 
                     pseudo: "ttt", 
                     password: "test", 
                     email: "test@gmail.com", 
                     birthdate: "1930-11-12" 
                 ) { 
                    id
                    name
                 }
        }`;

        await mutate({
            mutation: query,
        }).then((res)=>{
            console.log(res)
        }).catch((err)=>{
            console.log(err)
        })

    });
})