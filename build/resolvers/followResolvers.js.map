{"version":3,"sources":["../../src/resolvers/followResolvers.js"],"names":["AuthenticationError","Mutation","createFollow","parent","followerId","models","followModel","userModel","userInfo","info","follow","user","_id","follower","save","findOneAndUpdate","$push","following","id","followers","deleteFollow","findByIdAndRemove","$pull","Follow","args","findOne","exec"],"mappings":"AAAA,SAAQA,mBAAR,QAAkC,uBAAlC;;AAEA,eAAe;AACXC,cAAU;AACN;;;;;;AAMAC,sBAAc,OAAOC,MAAP,EAAe,EAACC,UAAD,EAAf,EAA6B,EAACC,QAAQ,EAACC,WAAD,EAAcC,SAAd,EAAT,EAAmCC,QAAnC,EAA7B,EAA2EC,IAA3E,KAAoF;AAC9F,gBAAI,CAACD,QAAL,EAAe;AACX,sBAAM,IAAIR,mBAAJ,CAAwB,2BAAxB,CAAN;AACH;AACD,kBAAMU,SAAS,MAAM,IAAIJ,WAAJ,CAAgB;AACjCK,sBAAMH,SAASI,GADkB;AAEjCC,0BAAUT;AAFuB,aAAhB,EAGlBU,IAHkB,EAArB;AAIA;AACA,kBAAMP,UAAUQ,gBAAV,CAA2B,EAACH,KAAKF,OAAOC,IAAb,EAA3B,EAA+C,EAACK,OAAO,EAACC,WAAWP,OAAOQ,EAAnB,EAAR,EAA/C,CAAN;AACA,kBAAMX,UAAUQ,gBAAV,CAA2B,EAACH,KAAKR,UAAN,EAA3B,EAA8C,EAACY,OAAO,EAACG,WAAWT,OAAOQ,EAAnB,EAAR,EAA9C,CAAN;;AAEA,mBAAOR,MAAP;AACH,SApBK;;AAsBN;;;;;AAKAU,sBAAc,OAAOjB,MAAP,EAAe,EAACe,EAAD,EAAf,EAAqB,EAACb,QAAQ,EAACC,WAAD,EAAcC,SAAd,EAAT,EAAmCC,QAAnC,EAArB,KAAsE;AAChF,gBAAI,CAACA,QAAL,EAAe;AACX,sBAAM,IAAIR,mBAAJ,CAAwB,2BAAxB,CAAN;AACH;AACD,kBAAMU,SAAS,MAAMJ,YAAYe,iBAAZ,CAA8BH,EAA9B,CAArB;;AAEA;AACA,kBAAMX,UAAUQ,gBAAV,CAA2B,EAACH,KAAKF,OAAOC,IAAb,EAA3B,EAA+C,EAACW,OAAO,EAACH,WAAWT,OAAOQ,EAAnB,EAAR,EAA/C,CAAN;AACA,kBAAMX,UAAUQ,gBAAV,CAA2B,EAACH,KAAKF,OAAOG,QAAb,EAA3B,EAAmD,EAACS,OAAO,EAACL,WAAWP,OAAOQ,EAAnB,EAAR,EAAnD,CAAN;AACA,mBAAOR,MAAP;AACH;;AArCK,KADC;AAyCXa,YAAQ;AACJZ,cAAM,OAAOM,SAAP,EAAkBO,IAAlB,EAAwB,EAACnB,QAAQ,EAACE,SAAD,EAAT,EAAqBC,QAArB,EAAxB,EAAwDC,IAAxD,KAAiE;AACnE,mBAAQ,MAAMF,UAAUkB,OAAV,CAAkB,EAACb,KAAKK,UAAUN,IAAhB,EAAlB,EAAyCe,IAAzC,EAAd;AACH,SAHG;AAIJb,kBAAU,OAAOA,QAAP,EAAiBW,IAAjB,EAAuB,EAACnB,QAAQ,EAACE,SAAD,EAAT,EAAvB,EAA8CE,IAA9C,KAAuD;AAC7D,mBAAO,MAAMF,UAAUkB,OAAV,CAAkB,EAACb,KAAKC,SAASA,QAAf,EAAlB,EAA4Ca,IAA5C,EAAb;AACH;AANG;AAzCG,CAAf","file":"followResolvers.js","sourcesContent":["import {AuthenticationError} from 'apollo-server-express'\n\nexport default {\n    Mutation: {\n        /**\n         * Creates a following/follower relationship between users\n         *\n         * @param {string} userId\n         * @param {string} followerId\n         */\n        createFollow: async (parent, {followerId}, {models: {followModel, userModel}, userInfo}, info) => {\n            if (!userInfo) {\n                throw new AuthenticationError('You are not authenticated');\n            }\n            const follow = await new followModel({\n                user: userInfo._id,\n                follower: followerId,\n            }).save();\n            // Push follower/following to user collection\n            await userModel.findOneAndUpdate({_id: follow.user}, {$push: {following: follow.id}});\n            await userModel.findOneAndUpdate({_id: followerId}, {$push: {followers: follow.id}});\n\n            return follow;\n        },\n\n        /**\n         * Deletes a following/follower relationship between users\n         *\n         * @param {string} id follow id\n         */\n        deleteFollow: async (parent, {id}, {models: {followModel, userModel}, userInfo}) => {\n            if (!userInfo) {\n                throw new AuthenticationError('You are not authenticated');\n            }\n            const follow = await followModel.findByIdAndRemove(id);\n\n            // Delete follow from users collection\n            await userModel.findOneAndUpdate({_id: follow.user}, {$pull: {followers: follow.id}});\n            await userModel.findOneAndUpdate({_id: follow.follower}, {$pull: {following: follow.id}});\n            return follow;\n        },\n\n    },\n    Follow: {\n        user: async (following, args, {models: {userModel},userInfo}, info) => {\n            return  await userModel.findOne({_id: following.user}).exec()\n        },\n        follower: async (follower, args, {models: {userModel}}, info) => {\n            return await userModel.findOne({_id: follower.follower}).exec()\n        },\n    },\n};"]}